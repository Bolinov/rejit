import os
import sys
import subprocess

from os.path import join
from subprocess import PIPE

# Import rejit utils.
dir_root = os.path.realpath('.')
while 'SConstruct' not in os.listdir(dir_root):
  dir_root = os.path.realpath(join(dir_root, '..'))
sys.path.insert(0, join(dir_root, 'tools'))
import utils

# These are exported from SConstruct and further passed down to SConscript
# files.
Import('env librejit help_messages')


SConscript('resources/engines/re2/SConscript', exports='env help_messages')
SConscript('resources/engines/rejit/SConscript', exports='env librejit help_messages')


# TODO: Move third party requirement check to their respective scripts.

# Check third party requirements.
print "Checking for javascript flot... ",
flot_git = 'git://github.com/flot/flot.git'
flot_dir = join(utils.dir_html_resources, 'flot')
if not os.path.exists(flot_dir) or not os.path.isdir(flot_dir):
  print "not found."
  ret = subprocess.check_call(['git', 'clone', flot_git, flot_dir])
  if ret != 0:
    print 'Failed to clone flot. Aborting build.'
    sys.exit(1)
else:
  print "ok."
